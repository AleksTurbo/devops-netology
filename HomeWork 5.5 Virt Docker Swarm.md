# Домашнее задание к занятию "5.5. Оркестрация кластером Docker контейнеров на примере Docker Swarm"

## Задача 1

- В чём отличие режимов работы сервисов в Docker Swarm кластере: replication и global?

```txt
Replicated  - сервис запускается в количестве экземпляров указанных при создании роя. При этом на отдельной
ноде может быть как несколько экземпляров приложения, так и не быть совсем (пример - сервис визуализации Grafana).

Global - сервис разворачивается обязательно на каждой ноде и в единственном экземпляре (например - сборщик метрик nodeexporter).
```

- Какой алгоритм выбора лидера используется в Docker Swarm кластере?

```txt
Механизм - Raft: решает проблему согласованности - чтобы все manager-ноды имели одинаковое представление о состоянии кластера
Лидер нода выбирается из управляючих нод путем Raft согласованного алгоритма. 
Лидер отправляет keepalive-пакеты с заданной периодичностью в пределах 150-300мс. 
Если пакеты не пришли, менеджеры начинают выборы нового лидера.
Сам Raft-алгоритм имеет ограничение на количество управляющих нод. 
Распределенные решения должны быть одобрены большинством управляющих узлов, называемых кворумом. 
Это означает, что рекомендуется нечетное количество управляющих узлов. 
Если кластер разбит, нечётное количество нод должно гарантировать, что кластер останется консистентным
```

- Что такое Overlay Network?

```txt
Overlay-сеть создает подсеть, которую могут использовать контейнеры в разных хостах swarm-кластера. 
Контейнеры на разных физических хостах могут обмениваться данными по overlay-сети (если все они прикреплены к одной сети). 
Overlay-сеть использует технологию vxlan, которая инкапсулирует layer 2 фреймы в layer 4 пакеты (UDP/IP). 
При помощи этого действия Docker создает виртуальные сети поверх существующих связей между хостами, которые могут оказаться 
внутри одной подсети. 
Любые точки, которые являются частью этой виртуальной сети, выглядят друг для друга так, будто они связаны поверх свича и 
не заботятся об устройстве основной физической сети. 
vxlan использует udp port 4789.
```

## Задача 2

Создаем Docker Swarm кластер в Яндекс.Облаке:

![Virt 5.5 TF+Ansbl deploy 6 VM](https://github.com/AleksTurbo/devops-netology/blob/main/Virt%205.5%20TF%2BAnsbl%20deploy%206%20VM.png "Virt 5.5 TF+Ansbl deploy 6 VM")
![Virt 5.5 TF+Ansbl  - docker node ls](https://github.com/AleksTurbo/devops-netology/blob/main/Virt%205.5%20TF%2BAnsbl%20%20-%20docker%20node%20ls%20.png "Virt 5.5 TF+Ansbl  - docker node ls")

## Задача 3

Создаем кластер мониторинга, состоящий из стека микросервисов:
![Virt 5.5 TF+Ansbl  - docker services ls](https://github.com/AleksTurbo/devops-netology/blob/main/Virt%205.5%20TF%2BAnsbl%20%20-%20docker%20services%20ls%20.png "Virt 5.5 TF+Ansbl  - docker services ls ")
![Virt 5.5 TF+Ansbl Grafana swarm services](https://github.com/AleksTurbo/devops-netology/blob/main/Virt%205.5%20TF%2BAnsbl%20Grafana%20swarm%20services.png "Virt 5.5 TF+Ansbl Grafana swarm services")

## Задача 4

Выполним на лидере Docker Swarm кластера команду: docker swarm update --autolock=true

![Virt 5.5 TF+Ansbl swarm lock](https://github.com/AleksTurbo/devops-netology/blob/main/Virt%205.5%20TF%2BAnsbl%20swarm%20lock.png "Virt 5.5 TF+Ansbl swarm lock")

```txt
--autolock=true опция требовать ввода ключа разблокировки на ноде, чтобы она могла заново присоединиться к кластеру, если была перезапущена. 
Ввод ключа позволит расшифровать лог Raft и загрузить все "секреты" в память ноды (логины, пароли, TLS ключи, SSH ключи и т.д.)
Для защиты кластера от несанкционированного доступа к файлам ноды. Например, получив жесткий диск сервера или образ диска VM с нодой,
 не получить доступ к кластеру и нодам без ключа.
```
