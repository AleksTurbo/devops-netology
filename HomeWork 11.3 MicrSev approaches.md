# Домашнее задание к занятию "11.3  "Микросервисы: подходы"

## Задание 1 - Обеспечить разработку

Для комплексного решения для обеспечения процесса разработки предлагаю систему Gitlab (<https://gitlab.com/>).

GitLab Ci/CD - Один из лучших CI/CD-инструментов, поскольку он предлагает различные функции, такие как просмотр кода, CI/CD, непрерывное развертывание и многое другое в рамках единой информационной панели. Есть механизм хранения и использования собственных докер-образов. Он содержит в себе весь необходимый функционал (для CI/CD) который централизован и удобно администрируется. GitLab популярен и имеет обширное комъюнити. Регулярно обновляется и получает новые функции. При необходимости может быть развернут локально.

Поддерживает все требуемые функции:

- Облачная система;
- Система контроля версий Git;
- Репозиторий на каждый сервис;
- Запуск сборки по событию из системы контроля версий;
- Запуск сборки по кнопке с указанием параметров;
- Возможность привязать настройки к каждой сборке;
- Возможность создания шаблонов для различных конфигураций сборок;
- Возможность безопасного хранения секретных данных: пароли, ключи доступа;
- Несколько конфигураций для сборки из одного репозитория;
- Кастомные шаги при сборке;
- Собственные докер образы для сборки проектов;
- Возможность развернуть агентов сборки на собственных серверах;
- Возможность параллельного запуска нескольких сборок;
- Возможность параллельного запуска тестов;

Кроме этого имеет:

- встроенный WiKi;
- встроенный механизм мониторинга и сбора метрик;
- управление Issues;
- планировщик To-Do List
- и др.

## Задание 2 - Логи

Решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре:

Предлагаю связку Vector + Clickhouse. Данный набор позволяет организовать транспорт данных из файла (например логи), которые мы собираем с помощью Vector и передаем в СУБД clickhouse и выводим результат в графиках с помощью lighthouse. Для работы lighthouse нам так же потребуется установить web server nginx.

### ClickHouse

- очень быстрая, очень отказоустойчивая и масштабируемая база данных. Поддерживает линейную маштабируемость. Имеет High availability - данные и вообще кластер, и на чтение, и на запись всегда будет доступен. Поддерживает сжатие данных. ClickHouse это поколоночная система, что само по себе означает, что сжатие данных работает очень хорошо. ClickHouse в Open Source.

### Vector

- инструмент для сбора, преобразования и отправки данных логов, метрик и событий. Vector представляет собой роутер сообщений, который принимает сообщения из источников, при необходимости применяет к ним преобразования и отправляет в один или несколько стоков. Vector может являться заменой filebeat и logstash, так как может выступать в обоих ролях - принимать и отправлять сообщения. Vector может принимать данные из 40 разных источников, таких как HTTP, Kafka, Kubernetes logs и прочие. Для каждого типа источника есть свой шаблон конфигурации, который можно найти в официальной документации. Vector позволяет преобразовывать или фильтровать данные, проходящие через него. Vector может отправлять данные в 50 разных стоков, которые в основном повторяют источники.

Цепочка потока данных строится по схеме: sources > transforms > sinks.

#### LightHouse — это легковесный веб-интерфейс для ClickHouse

Основные возможности:

- Список таблиц с фильтрацией и метаданными;
- Предварительный просмотр таблицы с фильтрацией и сортировкой;
- Выполнение запросов только для чтения.

Как вариант: можно заменить LightHouse => HouseOps или Grafana

#### HouseOps — UI/IDE для OSX, Linux и Windows

Основные возможности:

- Построение запросов с подсветкой синтаксиса;
- Просмотр ответа в табличном или JSON представлении;
- Экспортирование результатов запроса в формате CSV или JSON;
- Список процессов с описанием;
- Режим записи;
- Возможность остановки (KILL) запроса;
- Граф базы данных. Показывает все таблицы и их столбцы с дополнительной информацией;
- Быстрый просмотр размера столбца;
- Конфигурирование сервера.

Планируется разработка следующих возможностей:

- Управление базами;
- Управление пользователями;
- Анализ данных в режиме реального времени;
- Мониторинг кластера;
- Управление кластером;
- Мониторинг реплицированных и Kafka таблиц.

#### Grafana — платформа для мониторинга и визуализации

С помощью Grafana можно делать запросы, визуализировать, получать уведомления и разбираться в метриках, где бы они ни хранились.

Плагин источника данных ClickHouse поддерживает ClickHouse в качестве бэкенд базы данных.

## Задание 3 - Мониторинг

Для мониторинга предлагаю применить проверенное решение: стек prometheus + grafana + node exporter + alertmanager. Комплекс соответствует всем предьявляемым требованиям.

- Проверенный и широкораспространенный стек;
- Большое количество видов и типов собираемых метрик;
- Удобный графический интерфейс;

В данном случае получим:

- Базу данных Prometheus и интерфейс для выполнения PromQL;
- Визуализацию с помощью Grafana;
- Сбор метрик через Node Exporter;
- Мониторинг HTTP с использованием Blackbox;
- Отправку уведомлений в Telegram с помощью Alertmanager;
